<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Battle &middot; Code Kungfu</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description"
		content="Create your AI and duel with the other player.">
	<meta name="author" content="Indra Adam">
	
	<!-- Styles -->
	<link rel="stylesheet" href="./styles/bootstrap.css" >
    <link rel="stylesheet" href="./styles/bootstrap-responsive.min.css">
	<link rel="stylesheet" href="./styles/codemirror/codemirror.css">
    <link rel="icon" href="./img/favicon.png" type="image/png" />
	<style type="text/css">
		body {
	        padding-top: 40px;
	        padding-bottom: 0px;
	    }
		.CodeMirror {
			border: 1px solid black;
		}
		
		.CodeMirror-activeline-background {
			background: #e8f2ff !important;
		}
	</style>
	
</head>

<body>

	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a class="btn btn-navbar" data-toggle="collapse"
					data-target=".nav-collapse"> <span class="icon-bar"></span> <span
					class="icon-bar"></span> <span class="icon-bar"></span>
				</a> <a class="brand logo" href="./codeKungfu.html">Code Kungfu</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li><a href="./Battle.html" class="active">Battle</a></li>
						<li><a href="./scoreboard.html">Leader Board</a></li>
					</ul>
					<ul class="nav pull-right">
						<li><a href="" data-toggle="modal" data-target="#myModal">Sign
								in</a></li>
					</ul>
					<!--<button type="button" class="btn btn pull-right" data-toggle="modal" data-target="#myModal">Sign in</button>-->
				</div>
				<!--/.nav-collapse -->
			</div>
		</div>
	</div>
	<!-- Modal -->
	<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"
				aria-hidden="true">&times;</button>
			<h3 class="modaltemp">Sign in</h3>
		</div>
		<div class="modal-body">
			<button class="btn btn-primary">Connect with Facebook</button>
			<!--<form class="form-horizontal">
				<div class="control-group">
					<label class="control-label" for="inputEmail">Email</label>
					<div class="controls">
						<input type="text" id="inputEmail" placeholder="Email">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputPassword">Password</label>
					<div class="controls">
						<input type="password" id="inputPassword" placeholder="Password">
					</div>
				</div>
			</form>
  		</div>
		<div class="modal-footer">
			<button class="btn btn-primary">Connect with Facebook</button>
			<button class="btn btn-primary">Sign in</button>
			<button class="btn btn-success" data-dismiss="modal" data-toggle="modal" data-target="#signupModal">Sign up</button>-->
		</div>
	</div>
	<!-- Sign Up Modal
	<div id="signupModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  		<div class="modal-header">
    		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    		<h3 class="modaltemp">Register</h3>
  		</div>
  		<div class="modal-body">
    		<form class="form-horizontal">
				<div class="control-group">
					<label class="control-label" for="inputName">Full Name</label>
					<div class="controls">
						<input type="text" id="inputName" placeholder="Full Name">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputUsername">Username</label>
					<div class="controls">
						<input type="text" id="inputUsername" placeholder="Username">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputEmail">Email</label>
					<div class="controls">
						<input type="text" id="inputEmail" placeholder="Email">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputPassword">Password</label>
					<div class="controls">
						<input type="password" id="inputPassword" placeholder="Password">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputConfirmPassword">Confirm Password</label>
					<div class="controls">
						<input type="password" id="inputConfirmPassword" placeholder="Confirm Password">
					</div>
				</div>
			</form>
  		</div>
		<div class="modal-footer">
			<button class="btn btn-primary">Sign up</button>-->
	</div>
	</div>
	<div class="container">
		<div class="hero-unit span2">
			<h1>Battle</h1>
		</div>
		<div class="span6 pull-right profile">
			<img class="pull-right" src="./img/missing.png" width="25%"
				height="25%" />
			<h3 class="text-right">Anonymous&nbsp;&nbsp;</h3>
			<p class="lead text-right">
				Level: 0&nbsp;&nbsp;<br>Score: 0&nbsp;&nbsp;
			</p>
		</div>
	</div>
	<!-- /container -->

	<div class="container">
		<div class="span4">
			<table id="board" class="table table-bordered ttttable">
				<tr height="100px">
					<td id="0"></td>
					<td id="1"></td>
					<td id="2"></td>
				</tr>
				<tr height="100px">
					<td id="3"></td>
					<td id="4"></td>
					<td id="5"></td>
				</tr>
				<tr height="100px">
					<td id="6"></td>
					<td id="7"></td>
					<td id="8"></td>
				</tr>
			</table>
			<ul class="pager">
				<li id="previous" class="previous"><a href="#">&larr;</a></li>
				<li id="next" class="next"><a href="#">&rarr;</a></li>
			</ul>
			<div id="outcome"></div>
		</div>
		<div class="span7">
			<ul class="nav nav-tabs">
				<li class="active"><a href="">Tic Tac Toe</a></li>
			</ul>
            <p id="pre-codeTxt" class="cm-s-default" style="font-family:'Lucida Console'; font-size:12">
// FUNCTION THAT MAKES A MOVE

// PARAMETERS:
// - token: player the bot is player, 'x' or 'o'
// - board: current state of the board, e.g. '****x***o' represents a board with 'x' in the center and 'o' in the bottom right corner

// RETURNS:
// - new_board: board with the new move, e.g. '****x*x*o'

function get_next_move(token, board){
            </p>
			<textarea id="codeTxt" rows="15" class="span7 playarea">
//replace this sample code with your own code!
//sample code: a dumb AI that places its token in any random spot that is empty
var retry = true;
while(retry){
  var tryPos = Math.floor(Math.random() * 9);
  if(board[tryPos] == '*'){
    new_board = board.substr(0, tryPos) + token + board.substr(tryPos + 1);
    retry = false;
  }
}
			</textarea>
			<p id="post-codeTxt" class="cm-s-default" style="font-family:'Lucida Console'; font-size:12">            
return new_board;
}
            </p>
			<br />
			<div class="pull-right">
				<button class="btn btn-success" id="submitBtn">Submit</button>
				<div class="btn-group dropup">
					<button class="btn btn-warning" id="testBtn">Test</button>
					<button class="btn dropdown-toggle btn-warning"
						data-toggle="dropdown">
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu">
						<li><a tabindex="-1" href="">Easy</a></li>
						<li><a tabindex="-1" href="">Medium</a></li>
						<li><a tabindex="-1" href="">Hard</a></li>
					</ul>
				</div>
				<button class="btn btn-danger">Reset</button>
				<button class="btn" id="saveBtn">Save</button>
			</div>
		</div>
	</div>
	&nbsp;&nbsp;
	<div class="container">
		<div class="span1"></div>
		<div class="span9 alert">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<strong>You are not signed in!</strong> Sign in to participate in
			tournament and have your score registered.
		</div>
	</div>
	<br />
	<div id="results"></div>
	<div class="footerblock">
		<div class="container">
			<div class="span3">
				<a class="cleanlink" target="blank" href="http://smu.edu.sg">Singapore
					Management University</a>
			</div>
			<div class="span8 pull-right"></div>
			<div class="span1 pull-right">
				<a class="cleanlink" href="./aboutus.html">About Us</a>
			</div>
		</div>
	</div>

    <!-- Scripts -->
    
    <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="./scripts/jquery.js"></script>
    <script src="./scripts/bootstrap.min.js"></script>
    <script src="./scripts/codemirror/codemirror.js"></script>
    <script src="./scripts/codemirror/javascript.js"></script>
    <script src="./scripts/codemirror/runmode.js"></script>
    <script src="./scripts/codemirror/active-line.js"></script>
    <script src="./scripts/tictactoe.js"></script>
    <script type="text/javascript">
            
		//syntax highlighting
		CodeMirror.runMode($("#pre-codeTxt").html(), "text/javascript",document.getElementById("pre-codeTxt"));
		CodeMirror.runMode($("#post-codeTxt").html(), "text/javascript",document.getElementById("post-codeTxt"));
        
        //syntax highlighting on editor
        var editor = CodeMirror.fromTextArea(document.getElementById("codeTxt"), {
            lineNumbers : true,
            styleActiveLine : true,
            lineWrapping : true,
            matchBrackets : true,
            extraKeys : {
                "Enter" : "newlineAndIndentContinueComment"
            }
        });
        
        //test bot
        var testBot = function() {
            var t3 = new tictactoe();
            var results = $.parseJSON(t3.run_bot(editor.getValue()));
            displayResults(results);
        }
        
        //display results of test bot
        var displayResults = function(results){
        	
        	//display last history
        	$("#board").data('history',results.history);
        	displayHistory();
        	
        	//display outcome message
        	if(results.outcome==='-'){
                $("#outcome").html("<div class='alert alert-success'><strong>You Win!</strong></div>");
        	}else if((results.outcome==='x' && results.x==='human') || (results.outcome==='o' && results.o==='human')){
                $("#outcome").html("<div class='alert alert-info'><strong>Draw!</strong></div>");
        	}else{
                $("#outcome").html("<div class='alert alert-danger'><strong>You Lose!</strong></div>");
       		   
        	}
        }
        
        //display history
        var displayHistory = function(offset){
        	//set index
        	var index;
        	if(!offset){
        		var index = $("#board").data('history').length-1; //last
                $("#board").data('index', index);
        	}else{
                var index = $("#board").data('index') + offset;
                $("#board").data('index', index);
        	}
        	
        	//display
        	var state = $("#board").data('history')[index];
        	for(var pos=0; pos<9; pos++){
                $("#"+pos).html(state[pos]==='*'?'':state[pos]);
        	}
        }
        
        //save bot
        var saveBot = function(){
            $.ajax({
            	url: '/Codefu/ttt/save',
            	type: 'post',
            	data: {
            		email: 'shiling.tai@outlook.com',    //TODO: integrate with fb log in
                    code: editor.getValue()
            	},
            	success: function(data){
            	    console.log('saved. response: ' + data);
            	}
            });
        }
        
        //submit bot for tournament
        var submitBot = function(){
            $.ajax({
                url: '/Codefu/ttt/save',
                type: 'post',
                data: {
                    email: 'shiling.tai@outlook.com',    //TODO: integrate with fb log in
                    code: editor.getValue(),
                    participate: true
                },
                success: function(data){
                    console.log('saved. response: ' + data);
                }
            });
        }
        
        //event listeners
        $("#testBtn").on('click', testBot);
        $("#previous").on('click', function(){displayHistory(-1)});
        $("#next").on('click', function(){displayHistory(1)});
        $('#saveBtn').on('click', saveBot);
        $('#submitBtn').on('click', submitBot);
        
        //Google Analytics
        var _gaq = _gaq || [];
        _gaq.push([ '_setAccount', 'UA-39614464-1' ]);
        _gaq.push([ '_trackPageview' ]);
    
        (function() {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl'
                    : 'http://www')
                    + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
        
    </script>	
	
</body>
</html>